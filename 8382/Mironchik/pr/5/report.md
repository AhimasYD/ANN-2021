# Мирончик Павел, 8382, в.1 v.7

Модель выглядит следующим образом: 

```
inputs = keras.Input((6,))

encoder = keras.layers.Dense(32, activation='relu')(inputs)
encoder = keras.layers.Dense(32, activation='relu')(encoder)
encoder = keras.layers.Dense(2)(encoder)

decoder = keras.layers.Dense(32, activation='relu', name='decoder1')(encoder)
decoder = keras.layers.Dense(32, activation='relu', name='decoder2')(decoder)
decoder = keras.layers.Dense(6, name='decoder_out')(decoder)

regression = keras.layers.Dense(32, activation='relu')(encoder)
regression = keras.layers.Dense(32, activation='relu')(regression)
regression = keras.layers.Dense(1, name='regression_out')(regression)

model = keras.Model(inputs, outputs=[regression, decoder])
```

т.е. слои encoder - часть с закодированием данных, decoder - с декодированием,
regression - часть с регрессией. Видно, что decoder и regression отдельные 
'ветки' слоев, получающих данные из выхода части encoder.

Модель имеет 2 выхода: regression_out и decoder_out и один вход. 

Для обучения модели используется дадасет из 10000 сгенерированных элементов. При 
компиляции используется оптимизатор adam, функция мотерь mse (среднеквадратическая 
ошибка) и mae в качестве метрики.

```
model.compile(optimizer='adam', loss='mse', metrics=["mae"], loss_weights=[1, 0.9])
model.fit(train_data, [train_labels, train_data], epochs=100, batch_size=100, validation_split=0.1, verbose=0)
```

Оценка модели:

```
model.evaluate(test_data, [test_labels, test_data])
```

```
loss: 21.9375 - regression_out_loss: 21.1748 - decoder_out_loss: 0.8474 - regression_out_mae: 2.7353 - decoder_out_mae: 0.5316
```

По результатам проверки видно, что значения регрессии и декодирования
данных достаточно близки к идеальным. Средняя разница между ожидаемым
и полученным результатом регрессии составляет regression_out_mae=2.7353,
что в целом неплохо, если учитывать, что среднее значение регрессии 
составляет примерно 200 (со значительным разбросом в обе стороны).

Из полученной модели согласно заданию формируется 3 отдельных модели:

```
encoder_model = keras.Model(inputs, encoder)
regression_model = keras.Model(inputs, regression)

encoded_input = keras.Input(shape=(2,))
decoder_layer = model.get_layer("decoder1")(encoded_input)
decoder_layer = model.get_layer("decoder2")(decoder_layer)
decoder_layer = model.get_layer("decoder_out")(decoder_layer)
decoder_model = keras.Model(encoded_input, decoder_layer)
``` 

и затем сохраняются в формате `.h5`. После сохранения моделей в файлы
они загружаются из файлов с использованием `keras.models.load_model`.
С использованием полученных моделей формируются закодированные данные: 

```
---- encoded_test_data.csv ----
-5.685856628417968750e+01;3.295734786987304688e+01
-2.238238677978515625e+02;-4.974579238891601562e+01
-1.681323852539062500e+02;1.374738693237304688e+01
-2.322571868896484375e+02;-1.335017395019531250e+02
-3.344300079345703125e+01;2.468840217590332031e+01
-1.831948089599609375e+02;6.385381817817687988e-01
1.092119140625000000e+02;-2.606898117065429688e+01
1.758121459960937500e+03;1.248936080932617188e+01
-2.322189178466796875e+02;-1.335375061035156250e+02
-1.952208557128906250e+02;-1.273456954956054688e+01
-1.469560623168945312e+01;1.664684867858886719e+01
1.059106750488281250e+02;-2.500656127929687500e+01
-9.008540344238281250e+01;4.238489532470703125e+01
1.611335754394531250e+02;-3.793007659912109375e+01
1.631290626525878906e+01;8.123968243598937988e-01
-1.245158958435058594e+01;1.428105258941650391e+01
...
```

декодированные данные:

```
---- decoded_test_data.csv ----
7.078292369842529297e+00;-7.531683444976806641e-01;1.338697671890258789e-01;-5.290172100067138672e+00;2.346883296966552734e+00;2.337083339691162109e+00
1.527365264892578125e+02;4.809421300888061523e-01;1.095180988311767578e+00;-1.592075061798095703e+01;1.245591926574707031e+01;1.222961807250976562e+01
7.145495605468750000e+01;1.214228272438049316e+00;4.889574646949768066e-01;-1.146079540252685547e+01;8.327186584472656250e+00;8.652454376220703125e+00
2.421891784667968750e+02;-7.881370782852172852e-01;5.952122807502746582e-01;-1.884018516540527344e+01;1.540405273437500000e+01;1.603260803222656250e+01
1.291821718215942383e+00;-2.672998309135437012e-01;1.346523761749267578e-01;-3.568072080612182617e+00;8.643155097961425781e-01;1.037369489669799805e+00
9.061412048339843750e+01;8.767312765121459961e-01;2.764297127723693848e-01;-1.259464550018310547e+01;9.211753845214843750e+00;9.800117492675781250e+00
1.108244323730468750e+02;-5.615459680557250977e-01;-2.951043844223022461e-02;7.279157161712646484e+00;-1.025911045074462891e+01;1.086950874328613281e+01
9.871398925781250000e+02;-1.389947533607482910e+00;6.343799829483032227e-02;2.559695625305175781e+01;-2.841122245788574219e+01;2.934348487854003906e+01
...
```

и результаты регрессии, сопоставленные с идеальными значениями:

```
---- regression_test_predictions.csv ----
-3.410149011248023498e+00;-4.673073291778564453e+00
-4.549233298071007994e+02;-4.570541076660156250e+02
-1.430502533677800727e+02;-1.419669799804687500e+02
-9.092262969693236982e+02;-9.230828247070312500e+02
-1.940674255299228435e-01;8.684002161026000977e-01
-2.076632520666970265e+02;-2.095631866455078125e+02
2.873740687640933515e+02;2.802649536132812500e+02
7.836938378578493939e+03;7.823755371093750000e+03
-9.088378317681119825e+02;-9.232758789062500000e+02
...
```